<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popup Detection Example</title>
    <script src="../jquery/jquery.min.js"></script>
    <script src="popup-manager.js"></script>
    <script src="popup-receiver.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }

        /* Normal mode styles */
        .normal-mode {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .normal-mode .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .normal-mode .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .normal-mode .sidebar {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-right: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 250px;
            float: left;
        }

        .normal-mode .main-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-left: 270px;
        }

        .normal-mode .footer {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            clear: both;
        }

        /* Popup mode styles */
        .popup-mode {
            background: #f8f9fa;
            padding: 0;
            margin: 0;
        }

        .popup-mode .popup-container {
            padding: 20px;
            max-width: 100%;
            margin: 0;
        }

        .popup-mode .main-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 0;
        }

        .popup-mode .compact-mode {
            font-size: 14px;
        }

        .popup-mode .full-width {
            width: 100% !important;
            max-width: none !important;
        }

        .popup-mode .hide-header,
        .popup-mode .hide-footer,
        .popup-mode .hide-sidebar {
            display: none !important;
        }

        .btn-close-popup {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 9999;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
        }

        .btn-close-popup:hover {
            background: #c82333;
        }

        .info-panel {
            background: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .test-buttons {
            margin: 20px 0;
        }

        .test-buttons button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }

        .test-buttons button:hover {
            background: #0056b3;
        }

        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <!-- Header (hidden in popup mode) -->
    <div class="header">
        <h1>Main Application Header</h1>
        <p>This header is hidden when opened in popup mode</p>
    </div>

    <div class="container">
        <!-- Sidebar (hidden in popup mode) -->
        <div class="sidebar">
            <h3>Navigation</h3>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
            <p>This sidebar is hidden in popup mode</p>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <h2>Popup Detection Demo</h2>

            <div class="info-panel">
                <h3>Current Layout Status</h3>
                <div id="layout-status">
                    <p><strong>Mode:</strong> <span id="current-mode">Detecting...</span></p>
                    <p><strong>Is Popup:</strong> <span id="is-popup">Detecting...</span></p>
                    <p><strong>Is Custom Popup:</strong> <span id="is-custom-popup">Detecting...</span></p>
                    <p><strong>Layout:</strong> <span id="layout-type">Detecting...</span></p>
                </div>
            </div>

            <div class="info-panel">
                <h3>Window Information</h3>
                <div id="window-info">
                    <pre id="window-details">Loading...</pre>
                </div>
            </div>

            <div class="info-panel">
                <h3>Layout Configuration</h3>
                <div id="layout-config">
                    <pre id="layout-details">Loading...</pre>
                </div>
            </div>

            <div class="test-buttons">
                <h3>Test Buttons</h3>
                <button onclick="openPopup()">Open This Page in Popup</button>

                <h4>Popup Detection</h4>
                <p><strong>Note:</strong> Using PopupDetectionMixin for server-side popup detection without client-side loading indicators.</p>
            </div>

            <div class="info-panel">
                <h3>Content</h3>
                <p>This is the main content area. In popup mode, this content will be displayed without the header, sidebar, and footer.</p>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            </div>
        </div>
    </div>

    <!-- Footer (hidden in popup mode) -->
    <div class="footer">
        <p>&copy; 2024 Main Application Footer - Hidden in popup mode</p>
    </div>

    <script>
        // Initialize popup layout with custom configuration
        PopupLayout.init({
            classes: {
                popupMode: 'popup-mode',
                normalMode: 'normal-mode',
                compactMode: 'compact-mode',
                fullWidth: 'full-width',
                hideHeader: 'hide-header',
                hideFooter: 'hide-footer',
                hideSidebar: 'hide-sidebar',
                popupContainer: 'popup-container'
            },
            selectors: {
                header: '.header',
                footer: '.footer',
                sidebar: '.sidebar',
                main: '.main-content',
                breadcrumb: '.breadcrumb'
            },
            callbacks: {
                onPopupDetected: function(layout) {
                    console.log('Popup mode detected!', layout);
                    updateDisplay();
                    // Add close button automatically
                    PopupLayout.addCloseButton();
                },
                onNormalModeDetected: function(layout) {
                    console.log('Normal mode detected!', layout);
                    updateDisplay();
                    // Remove close button
                    PopupLayout.removeCloseButton();
                },
                onLayoutChanged: function(layout) {
                    console.log('Layout changed!', layout);
                    updateDisplay();
                }
            }
        });

        // Update display information
        function updateDisplay() {
            const layout = PopupLayout.getCurrentLayout();

            // Update status display
            document.getElementById('current-mode').textContent = layout.isCustomPopup ? 'Popup Mode' : 'Normal Mode';
            document.getElementById('is-popup').textContent = layout.isPopup ? 'Yes' : 'No';
            document.getElementById('is-custom-popup').textContent = layout.isCustomPopup ? 'Yes' : 'No';
            document.getElementById('layout-type').textContent = layout.layout;

            // Update window info
            document.getElementById('window-details').textContent = JSON.stringify(layout.windowInfo, null, 2);

            // Update layout config
            document.getElementById('layout-details').textContent = JSON.stringify(layout, null, 2);
        }

        // Open this page in popup
        function openPopup() {
            const currentUrl = window.location.href;

            // Create a button element with popup attributes
            const $button = $('<button>')
                .attr('custom-popup-page', '')
                .attr('custom-popup-page-url', currentUrl)
                .attr('custom-popup-page-width', '800')
                .attr('custom-popup-page-height', '600')
                .attr('custom-popup-page-layout', 'empty')
                .attr('custom-popup-page-data', 'testData')
                .attr('custom-popup-page-handler', 'onPopupClose')
                .text('Open Popup')
                .hide();

            // Add to body and trigger click
            $('body').append($button);
            $button.trigger('click');
            $button.remove();
        }

        // Refresh layout detection
        // Layout functions removed - using PopupDetectionMixin for server-side handling

        // Close handler for popup
        function onPopupClose(config, element) {
            console.log('Popup closed!', config, element);
            alert('Popup was closed!');
        }

        // Test data
        window.testData = {
            message: 'Hello from main page!',
            timestamp: new Date().toISOString(),
            features: ['popup-detection', 'layout-management']
        };


        // Initialize display
        $(document).ready(function() {
            updateDisplay();
        });
    </script>
</body>
</html>
